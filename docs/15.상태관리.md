

# 상태관리


## Server 상태관리

### axios 애러 핸들링

- 시나리오 : 로그인 하려고 하는데,(어이쿠..!) body 정보를 주지 않았다.  
- 그래서 서버는 400 응답을 주고, error.response에 정보를 담아준다.

- postman 요청시 보여주는 애러 정보는 사실 error?.response.data 객체 이다. (아래와 같음)

```ts
{
    "statusCode": 400,
    "message": [
        "email_id must be an email",
        "password must be a string"
    ],
    "error": "Bad Request"
}
```

- axios에서는 다음 처럼 참조 및 핸들링 한다.   

```
try:
// case. 성공적으로 요청이 이루어진 경우
catch:
// case1. 요청이 이루어졌으며 서버가 2xx의 범위를 벗어나는 상태 코드로 응답했습니다.
// case2. 요청이 이루어 졌으나 응답을 받지 못했습니다.
// case3. 오류를 발생시킨 요청을 설정하는 중에 문제가 발생했습니다.
```
```ts
const loginMemberInfo = async (body: loginMemberInfoInput) => {
      try {
        const res = await axios.post("member/login-member-info");
        // case. 성공적으로 요청이 이루어진 경우
        return res.data as loginMemberInfoOutput;
      } catch (error) {
        // case1. 요청이 이루어졌으며 서버가 2xx의 범위를 벗어나는 상태 코드로 응답했습니다.
        if (error.response) {
          console.log(
            "요청이 이루어졌으며 서버가 2xx의 범위를 벗어나는 상태 코드로 응답."
          );
          console.log(error?.response.data); // 애러의 응답안에 들어 있다.
          // {statusCode: 400, message: Array(2), error: "Bad Request"}error: "Bad Request"message: (2) ["email_id must be an email", "password must be a string"]0: "email_id must be an email"1: "password must be a string"length: 2__proto__: Array(0)statusCode: 400__proto__: Object
          console.log(error?.response.status);
          // 400
          console.log(error?.response.headers);
          // {content-length: "108", content-type: "application/json; charset=utf-8"}
        }
        // case2. 요청이 이루어 졌으나 응답을 받지 못했습니다.
        else if (error?.request) {
          console.log("요청이 이루어 졌으나 응답을 받지 못했습니다.");
          // `error?.request`는 브라우저의 XMLHttpRequest 인스턴스 또는
          // Node.js의 http.ClientRequest 인스턴스입니다.
          console.log(error?.request); // XMLHttpRequest
        }
        // case3. 오류를 발생시킨 요청을 설정하는 중에 문제가 발생했습니다.
        else {
          console.log("Error?", error?.message);
        }
      }
    },
```

- 위 axios 요청의 애러를 핸들링하면, react-query는 무조건 요청이 성공으로 보게된다.

### 

## Client 상태관리